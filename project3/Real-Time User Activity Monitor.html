<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Activity Monitor</title>
<style>
  body { font-family: Arial; }
  #log { border: 1px solid #ccc; height: 250px; overflow-y: auto; padding: 10px; }
  .warning { color: red; font-weight: bold; }
</style>
</head>
<body>

<h2>User Activity Monitor</h2>

<input type="text" placeholder="Focus here">
<button>Click Me</button>

<div id="log"></div>

<br>
<button onclick="resetLog()">Reset</button>
<button onclick="exportLog()">Export</button>

<p id="warning" class="warning"></p>

<script>
let activities = [];
let clickCount = 0;
const CLICK_THRESHOLD = 10;

const logDiv = document.getElementById("log");
const warning = document.getElementById("warning");

function logActivity(type, target, phase) {
  const activity = {
    type,
    target,
    phase,
    time: new Date().toLocaleTimeString()
  };

  activities.push(activity);
  updateLog();

  if (type === "click") {
    clickCount++;
    if (clickCount > CLICK_THRESHOLD) {
      warning.textContent = "Suspicious activity detected: Too many clicks!";
    }
  }
}

function updateLog() {
  logDiv.innerHTML = "";
  activities.forEach(a => {
    logDiv.innerHTML += `
      <div>[${a.time}] ${a.type.toUpperCase()} on ${a.target} (${a.phase})</div>
    `;
  });
}

document.addEventListener("click", e => {
  logActivity("click", e.target.tagName, "bubbling");
}, false);

document.addEventListener("click", e => {
  logActivity("click", e.target.tagName, "capturing");
}, true);

document.addEventListener("keydown", e => {
  logActivity("key", e.key, "bubbling");
});

document.addEventListener("focusin", e => {
  logActivity("focus", e.target.tagName, "bubbling");
});

function resetLog() {
  activities = [];
  clickCount = 0;
  logDiv.innerHTML = "";
  warning.textContent = "";
}

function exportLog() {
  let text = activities.map(a =>
    `[${a.time}] ${a.type.toUpperCase()} | ${a.target} | ${a.phase}`
  ).join("\n");

  const blob = new Blob([text], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "activity-log.txt";
  link.click();
}
</script>

</body>
</html>