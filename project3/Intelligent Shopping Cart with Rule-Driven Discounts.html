<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shopping Cart</title>
<style>
  table { border-collapse: collapse; width: 90%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
</style>
</head>
<body>

<h2>Products</h2>
<button onclick="addToCart('Laptop',1000,'electronics')">Add Laptop</button>
<button onclick="addToCart('Book',20,'education')">Add Book</button>
<button onclick="addToCart('Headphones',150,'electronics')">Add Headphones</button>

<h2>Cart</h2>
<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Category</th>
      <th>Price</th>
      <th>Qty</th>
      <th>Remove</th>
    </tr>
  </thead>
  <tbody id="cartBody"></tbody>
</table>

<br>

<input type="text" id="coupon" placeholder="Enter Coupon Code">
<button onclick="applyCoupon()">Apply Coupon</button>

<h3 id="total"></h3>

<script>
let cart = [];
let couponDiscount = 0;
let categoryDiscount = 0;

function addToCart(name, price, category) {
  let item = cart.find(p => p.name === name);
  if (item) item.quantity++;
  else cart.push({ name, price, quantity: 1, category });
  renderCart();
}

function updateQuantity(index, value) {
  cart[index].quantity = Math.max(1, value);
  renderCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  renderCart();
}

function applyCoupon() {
  let code = document.getElementById("coupon").value.trim().toUpperCase();
  couponDiscount = 0;
  categoryDiscount = 0;

  if (code === "SAVE10") couponDiscount = 0.10;
  else if (code === "SAVE20") couponDiscount = 0.20;
  else if (code === "ELEC5") categoryDiscount = 0.05;

  renderCart();
}

function calculateDiscounts(subtotal) {
  let discount = subtotal * couponDiscount;

  let electronicsTotal = cart
    .filter(p => p.category === "electronics")
    .reduce((sum, p) => sum + p.price * p.quantity, 0);

  discount += electronicsTotal * categoryDiscount;

  let totalQty = cart.reduce((sum, p) => sum + p.quantity, 0);
  if (totalQty >= 5) discount += subtotal * 0.10;

  let hour = new Date().getHours();
  if (hour >= 18 && hour <= 22) discount += subtotal * 0.05;

  return discount;
}

function renderCart() {
  const body = document.getElementById("cartBody");
  body.innerHTML = "";

  let subtotal = 0;

  cart.forEach((item, index) => {
    subtotal += item.price * item.quantity;
    body.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>${item.category}</td>
        <td>$${item.price}</td>
        <td>
          <input type="number" min="1" value="${item.quantity}"
          onchange="updateQuantity(${index}, this.value)">
        </td>
        <td><button onclick="removeItem(${index})">X</button></td>
      </tr>
    `;
  });

  let discount = calculateDiscounts(subtotal);
  let total = subtotal - discount;

  document.getElementById("total").innerHTML = `
    Subtotal: $${subtotal.toFixed(2)} <br>
    Discount: -$${discount.toFixed(2)} <br>
    <strong>Total: $${total.toFixed(2)}</strong>
  `;
}

renderCart();
</script>

</body>
</html>